metagene-maker
==============

Makes metagene plots for bedgraphs over given regions in bed files for human and mouse only. Useful in analysis of ChIRP-seq, ChIP-seq, GRO-seq, and other NGS datasets.

Simple start
----------

1. Go to 'releases' above and download the latest tar.gz file. Alternatively, 
2. Unzip with `tar xvzf metagene-maker-0.x.tar.gz>`
3. Go into the folder: `cd <metagene-maker-0.x>`
4. Install: `sudo python setup.py install`
5. Make config file (see below)
6. Ensure that you have a bedgraph for every sample you want to analyze.
7. Ensure that you have properly formatted BED6 files for every region for which you want to build average profiles.
8. Run: `metagene_maker <config file> <name> <outputDir>` where <config file> is the configuration file you make using `example.conf` (provided) as the template. Instructions for making configuration file are below. Run this either in `screen` or `nohup`.
9. Output: tab delimited files for each region in a new `averages` folder in the user-provided output directory.

Example
-------

`metagene_maker config/test.txt M3_ChIP chip/`

Dependencies
--------

Python (>2.7) and R (>2.14)
Numpy (>=1.7)

Rscript should be callable from the command line

At least 4 GB RAM if your largest bedgraph is 1 GB and you use 4 cores (empirical rule: n cores * m GB bedgraph --> mn GB RAM needed)

Todo
--------

Still doesn't work too well for stranded bedgraphs (i.e. GRO-seq data). Implementation is in progress.

Want to make metagenes that concatenate previously made metagenes (i.e. promoter, CDS, TES). Currently implemented as part of R script but not part of package yet.

Want to make metagenes for mRNAs (5'UTR, CDS, 3'UTR). Introns need to be thrown out.

Report a histogram of region sizes for processed regions in region space (not chr space)

Configuration file (see example.conf for an example)
--------

### Bedgraph columns
**folder:** the name of the sample (should also be the name of the folder where sample-specific intermediate files will be made)

**bedGraphLoc:** absolute path to bedgraph

**stranded:** + if plus only, - if minus only, 0 if no strand information. IMPORTANT if your regions are also strand specific.

### Region columns
**regionType:** name of region

**fileLoc:** absolute path to file specifying the regions of interest

**header:** y if header, n if no header

**stranded:** y if directional (i.e. TSS's), n if not directional (i.e. enhancers). IMPORTANT because some region profiles (like transcription start sites) have assymetrical shapes.

**limitSize:** y if only regions >200bp and <200kb should be considered; n if no limitation

**numBins:** number of bins. anywhere between 100 and 1000 is good

**extendRegion:** y if regions in the bed file should be extended 1x upstream and downstream; n otherwise

Directory structure
------

### Parent directory
the directory specified in the configuration file; contains all files generated by this pipeline

### Subfolders

**averages**: contains one file for each region type; each file is an Excel spreadsheet with graphable metagenes for each sample

**\<sample\>**: a folder for each sample, named as described in the config file; contains intermediate files described below

### Contents of each sample folder

**bedGraphByChr:** bedgraphs split by chromosome

**bins:** in this folder, there are subfolders for each region type, containing profiles for each instance of the region, intermediate RData files, and metagene plots

